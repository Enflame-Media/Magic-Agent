name = "happy-admin"
main = "src/worker/index.ts"
compatibility_date = "2025-01-08"
compatibility_flags = ["nodejs_compat"]

# Cloudflare Account ID
account_id = "81f483e6767ea3194467ecef42840f79"

# Enable Node.js compatibility for AsyncLocalStorage (required by Better-Auth)
[build]
command = ""

# Static assets (Vue.js SPA)
[site]
bucket = "./dist"

#############################
# Development Environment
#############################
[env.dev]
name = "happy-admin-dev"
vars = { ENVIRONMENT = "development" }

# Custom domain routing
routes = [
    { pattern = "happy-admin-dev.enflamemedia.com", custom_domain = true }
]

# D1 Database binding (development) - for Better-Auth storage
[[env.dev.d1_databases]]
binding = "DB"
database_name = "happy-admin-dev"
database_id = "PLACEHOLDER_DEV_DB_ID"

# Analytics Engine SQL API configuration
# Note: Analytics Engine is queried via REST API, not direct binding
# The ANALYTICS_ACCOUNT_ID and ANALYTICS_API_TOKEN secrets are used for API access
# Dataset: sync_metrics_dev (from happy-server-workers)

[env.dev.observability]
[env.dev.observability.logs]
enabled = true
head_sampling_rate = 1
invocation_logs = true
persist = true

#############################
# Production Environment
#############################
[env.prod]
name = "happy-admin-prod"
vars = { ENVIRONMENT = "production" }

# Custom domain routing
routes = [
    { pattern = "happy-admin.enflamemedia.com", custom_domain = true }
]

# D1 Database binding (production) - for Better-Auth storage
[[env.prod.d1_databases]]
binding = "DB"
database_name = "happy-admin-prod"
database_id = "PLACEHOLDER_PROD_DB_ID"

# Analytics Engine SQL API configuration
# Note: Analytics Engine is queried via REST API, not direct binding
# The ANALYTICS_ACCOUNT_ID and ANALYTICS_API_TOKEN secrets are used for API access
# Dataset: sync_metrics_prod (from happy-server-workers)

[env.prod.observability]
[env.prod.observability.logs]
enabled = true
head_sampling_rate = 1
invocation_logs = true
persist = true
